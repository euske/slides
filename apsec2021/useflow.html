<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<html>
<head>
<title>
Improving Semantic Consistency of Variable Names with Use-Flow Graph Analysis -
Yusuke Shinyama, Yoshitaka Arahori and Katsuhiko Gondow (APSEC 2021 Paper #83)
</title>
<style><!--
body { line-height: 1.5; }
h1 { border-bottom: solid 4px #000080; }
h2 { border-bottom: solid 2px #000080; }
h3 { border-bottom: solid 1px #000080; }
table { border-collapse: collapse; margin: 0.5em; }
kbd { border: 1px solid black; padding: 4px; margin: 4px; }
code { font-weight: bold; }
pre { border: 1px solid black; padding: 0.3em; }
.bl { outline: 1px solid black; padding: 2px; font-size: 120%; }
.announce { font-size: 120%; font-weight: bold; }
.author { text-align: right; }
.figure { outline: 1px solid black; padding: 0.5em; margin: 1em; text-align: center; }
.example { outline: 1px solid black; padding: 0.5em; margin: 1em; }
.notice { text-align: center; font-weight: bold; outline: 4px solid black; padding: 1em; margin: 1em; font-size: 200%; }
.comment { color: green; }
.v1 { background: cyan; }
.v2 { background: magenta; }
.pair { background: #000088; color: white; padding: 2px; }
.rewrite { color: white; background: black; padding: 4px; }
.evidence { border-bottom: 1px solid black; margin-top: 0.5em; }
.cat { outline: 1px dashed black; padding: 2px; background: #eeeeee; margin: 1em; }
.src0 { background:#eeffff; }
.src0 mark { background:#ff88ff; }
.src1 { background:#ffffee; }
.src1 mark { background:#44cc44; }
.cand { margin: 1em; padding: 1em; outline: 2px solid black; }
.old { background: #ccccff; }
.old mark { color: white; background: blue; }
.new { background: #88ff88; }
.new mark { color: black; background: yellow; }
.match { background: #ffcccc; }
.match mark { color: white; background: red; }
.support { background: green; color: white; }
--></style>
</head>
<body>

<div class=nav>
<a href="../index.html">&lt; back</a>
</div>
<h1>Improving Semantic Consistency of Variable Names with Use-Flow Graph Analysis</h1>
<div class=announce>
URL: <code>https://euske.github.io/</code>
</div>

<div class=author>
Yusuke Shinyama<br>
Yoshitaka Arahori<br>
Katsuhiko Gondow<br>
(APSEC 2021 Paper #83)<br>
</div>

<ol>
<li> <a href="#background">Background: Consistency is Crucial for Maintaining Large Software Projects</a>
<li> <a href="#objective">Goal: Detecting Inconsistent Names in Source Code</a>
<li> <a href="#inconsistency">How to Catch Inconsistency?</a>
<li> <a href="#datapath">"Use flow" of variables</a>
<li> <a href="#learning">Training and Prediction</a>
<li> <a href="#evaluation">Experiment and Evaluation</a>
<li> <a href="#discussion">Discussion</a>
<li> <a href="#contribution">Conclusion</a>
</ol>


<h2 id="background">1. Background: Consistency is Crucial for Maintaining Large Software Projects</h2>
<ul>
<li> Large projects are developed by a team with multiple people.
  <ul>
    <li> Even if there's only a single developer, they turn into a different person over time!
  </ul>
<li> A style guide is set up to facilitate collaboration of team members.
  <ul>
    <li> Source code style guides:
      <ul>
	<li> <a href="https://google.github.io/styleguide/jsguide.html">Google JavaScript Style Guide</a>
	<li> <a href="https://github.com/nytimes/objective-c-style-guide/">NYTimes Objective-C Style Guide</a>
      </ul>
    <li> There's little guideline of how to give a name to variables and functions...
      <ul>
        <li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/general-naming-conventions">Microsoft General Naming Conventions</a>
      </ul>
  </ul>
<li> Identifiers are <strong>crucial</strong> for program understanding:
  <ul>
    <li> Programmers rely on the meaning of names.
      <a href="https://ieeexplore.ieee.org/document/1631100">[Lawrie, 06]</a>
    <li> Bad names obstructs program understanding, resulting in bad code.
      <a href="https://ieeexplore.ieee.org/document/7961504">[Avidan, 17]</a>
    <li> The importance of names are also emphasized in "Code Complete"
      and "The Practice of Programming".
  </ul>
</ul>


<h2 id="objective">2. Goal: Detecting Inconsistent Names in Source Code</h2>

<blockquote><pre>
void printResult(Stream <span class=v1>out</span>, String result) {
  <span class=v1>out</span>.writeLine("result:"+result);
}

void printStat(Stream <span class=v1>out</span>, int stat) {
  <span class=v1>out</span>.writeLine("stat:"+stat);
}

void printInfo(Stream <span class=v2>strm</span>, String info) {
  <span class=v2>strm</span>.writeLine("info:"+info);  <span class=comment>// XXX "strm" should be "out".</span>
}
</pre></blockquote>
<p>
Note: "<code>out</code>" might not necessarily be the best name
for an output stream, but it is <strong>consistent</strong> throughout the program.

<p>We also tried to:
<ol type=a>
  <li> Make an adjustable system:<br>
    Each project uses the same word for different senses:
    <ul>
      <li> "<code>view</code>" in a GUI application.
      <li> "<code>view</code>" in an SQL engine.
    </ul>
    Or different abbreviations:
    <ul>
      <li> <code>message</code>
      <li> <code>msg</code>
    </ul>
  <li> <strong>Not</strong> use a dictionary or heuristics.
  <li> Make the system transparent:
    <ul>
      <li> Present <strong>how</strong> they are inconsistent to the developer.
    </ul>
</ol>

<h3 id="related">2.1. Related Work</h3>
<ul>
<li> A lot of work has been done for the problem of identifiers:
  <ul>
    <li> Checking the relevance of method names:
      <a href="https://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.232.9803">[H&oslash;st, 09]</a>
    <li> Generating comments from source code:
      <a href="https://dl.acm.org/citation.cfm?id=2521973">[Sridhara, 12]</a>
    <li> Propose a method name based on code:
      <a href="https://miltos.allamanis.com/publications/2015suggesting/">[Allamanis, 15]</a>
    <li> Infer the original variable names and types from obfuscated JavaScript code:
      <a href="https://www.sri.inf.ethz.ch/publications/raychev2015predicting">[Raychev, 15]</a>
    <li> Extract an embedding from code (code2vec):
      <a href="https://arxiv.org/abs/1803.09473">[Alon, 18]</a>
  </ul>
<li> Variable names are just as important as method names:
  <ul>
    <li> Variables are named after "things" in an application domain.
    <li> They are typically nouns, which are much more varied than verbs.
  </ul>
</ul>


<h2 id="inconsistency">3. How to Catch Inconsistency?</h2>

<ol>
<li> Construct a mapping between the <u>usage</u> and the <u>name</u> for each variable:
<ul>
<li> Variable usage:
<pre>
<span class=bl>   </span> = open(...);
write(<span class=bl>   </span>, ...);
</pre>
<li> Variable name: <code>out</code>
</ul>
<li> Find all the variables that have the same <u>usage</u>:
<ul>
<li>
<pre>
<span class=bl>strm</span> = open(...);
write(<span class=bl>strm</span>, ...);
</pre>
</ul>
<li> Compare the variable names and single out the outliers.
<ul>
  <li> <code>out</code>
  <li> <code>out</code>
  <li> <code><mark>strm</mark></code> (Hey!)
  <li> <code>out</code>
</ul>
</ol>

<h2 id="datapath">4. "Use Flow" of Variables</h2>

<ul>
<li> Now, how do we express "the usage of a variable"?
<li> Usage of variable = Sequence of operations
  applied to the value assigned into that variable.
<li> Let us call this dataflow of the variable "<strong>use flow</strong>".
</ul>

<h3 id="useflow">4.1. Example of use flows</h3>
<p>
Take a look at the variable <code><mark>line</mark></code>:
<blockquote><pre>
private BufferedReader fp;

public String get() {
    String <mark>line</mark> = fp.readLine();
    int i = <mark>line</mark>.indexOf(' ');
    return <mark>line</mark>.substring(0, i);
}
</pre></blockquote>
<p>
Here is its data flow visualization:
<div class=figure>
<!-- Title: get() Pages: 1 -->
<svg width="270pt" height="454pt"
 viewBox="0.00 0.00 270.00 454.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 450)">
<title>get()</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-450 266,-450 266,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_a</title>
<polygon fill="none" stroke="#000000" points="8,-65 8,-367 254,-367 254,-65 8,-65"/>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<ellipse fill="none" stroke="#000000" cx="184" cy="-428" rx="27" ry="18"/>
<text text-anchor="middle" x="184" y="-424.3" font-family="Times,serif" font-size="14.00" fill="#000000">fp</text>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<polygon fill="none" stroke="#000000" points="230,-359 138,-359 138,-323 230,-323 230,-359"/>
<text text-anchor="middle" x="184" y="-337.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">readLine()</text>
</g>
<!-- N1&#45;&gt;N2 -->
<g id="edge1" class="edge">
<title>N1&#45;&gt;N2</title>
<path fill="none" stroke="#000000" d="M184,-409.9735C184,-398.1918 184,-382.5607 184,-369.1581"/>
<polygon fill="#000000" stroke="#000000" points="187.5001,-369.0033 184,-359.0034 180.5001,-369.0034 187.5001,-369.0033"/>
<text text-anchor="middle" x="203" y="-380.8" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N4 -->
<g id="node4" class="node">
<title>N4</title>
<polygon fill="none" stroke="#000000" points="172,-234 88,-234 88,-198 172,-198 172,-234"/>
<text text-anchor="middle" x="130" y="-212.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">indexOf()</text>
</g>
<!-- N2&#45;&gt;N4 -->
<g id="edge2" class="edge">
<title>N2&#45;&gt;N4</title>
<path fill="none" stroke="red" stroke-width="3" d="M176.1479,-322.8239C167.1497,-301.9946 152.3056,-267.6333 141.8884,-243.5193"/>
<polygon fill="red" stroke="red" points="145.0404,-241.99 137.8615,-234.198 138.6144,-244.7661 145.0404,-241.99"/>
<text text-anchor="middle" x="178" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N6 -->
<g id="node6" class="node">
<title>N6</title>
<polygon fill="none" stroke="#000000" points="179.5,-109 80.5,-109 80.5,-73 179.5,-73 179.5,-109"/>
<text text-anchor="middle" x="130" y="-87.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">substring()</text>
</g>
<!-- N2&#45;&gt;N6 -->
<g id="edge4" class="edge">
<title>N2&#45;&gt;N6</title>
<path fill="none" stroke="#000000" d="M195.0166,-322.8274C201.3258,-310.7139 208,-294.1913 208,-278.5 208,-278.5 208,-278.5 208,-153.5 208,-137.118 197.3924,-124.3189 184.0009,-114.6879"/>
<polygon fill="#000000" stroke="#000000" points="185.6684,-111.5979 175.3729,-109.097 181.8617,-117.4724 185.6684,-111.5979"/>
<text text-anchor="middle" x="227" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<polygon fill="none" stroke="#000000" points="104,-359 50,-359 50,-323 104,-323 104,-359"/>
<text text-anchor="middle" x="77" y="-337.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">&#39; &#39;</text>
</g>
<!-- N3&#45;&gt;N4 -->
<g id="edge3" class="edge">
<title>N3&#45;&gt;N4</title>
<path fill="none" stroke="#000000" d="M78.5297,-322.8344C80.2411,-308.3271 83.7865,-287.7294 91,-271 95.3103,-261.0035 101.6359,-251.0116 107.9437,-242.3401"/>
<polygon fill="#000000" stroke="#000000" points="110.8998,-244.2351 114.1702,-234.1576 105.3292,-239.9961 110.8998,-244.2351"/>
<text text-anchor="middle" x="110" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg0</text>
</g>
<!-- N4&#45;&gt;N6 -->
<g id="edge6" class="edge">
<title>N4&#45;&gt;N6</title>
<path fill="none" stroke="red" stroke-width="3" d="M130,-197.8239C130,-177.2723 130,-143.5472 130,-119.4893"/>
<polygon fill="red" stroke="red" points="133.5001,-119.198 130,-109.198 126.5001,-119.198 133.5001,-119.198"/>
<text text-anchor="middle" x="149" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg1</text>
</g>
<!-- N5 -->
<g id="node5" class="node">
<title>N5</title>
<polygon fill="none" stroke="#000000" points="70,-234 16,-234 16,-198 70,-198 70,-234"/>
<text text-anchor="middle" x="43" y="-212.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">0</text>
</g>
<!-- N5&#45;&gt;N6 -->
<g id="edge5" class="edge">
<title>N5&#45;&gt;N6</title>
<path fill="none" stroke="#000000" d="M54.0754,-197.8986C62.9531,-183.6074 75.8861,-163.2677 88,-146 94.7619,-136.3613 102.5016,-126.0422 109.4796,-116.9762"/>
<polygon fill="#000000" stroke="#000000" points="112.2585,-119.1041 115.6239,-109.058 106.7282,-114.8127 112.2585,-119.1041"/>
<text text-anchor="middle" x="107" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg0</text>
</g>
<!-- N7 -->
<g id="node7" class="node">
<title>N7</title>
<polygon fill="none" stroke="#000000" points="161,-36 99,-36 99,0 161,0 161,-36"/>
<text text-anchor="middle" x="130" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#000000">return</text>
</g>
<!-- N6&#45;&gt;N7 -->
<g id="edge7" class="edge">
<title>N6&#45;&gt;N7</title>
<path fill="none" stroke="red" stroke-width="3" d="M130,-72.9551C130,-64.8828 130,-55.1764 130,-46.1817"/>
<polygon fill="red" stroke="red" points="133.5001,-46.0903 130,-36.0904 126.5001,-46.0904 133.5001,-46.0903"/>
</g>
</g>
</svg>
</div>
<p>
The <u>red lines</u> above = a use flow of <code><mark>line</mark></code>:
<ul>
  <li> <code>fp.readLine()</code> &rarr; <code><mark>line</mark></code> &rarr; <code>#this:indexOf()</code> &rarr; <code>#arg1:substring()</code>
</ul>
<p>
This path shows what is assigned to the variable <code>line</code> and
how it is used.

<h3 id="interp">4.2. Make It Interprocedural</h3>
<blockquote><pre>
private BufferedReader fp;

public String get() {
    String <mark>line</mark> = fp.readLine();
    int i = <mark>line</mark>.indexOf(' ');
    return <mark>line</mark>.substring(0, i);
}

public void show() {
    String <mark>name</mark> = get();
    System.out.println(<mark>name</mark>+"!!");
}
</pre></blockquote>
<p>
Note that <code><mark>line</mark></code> in function <code>get()</code>
is now <code>name</code> in function <code>show()</code>.
<p>
Here's the data flow graph:
<div class=figure>
<!-- Title: A Pages: 1 -->
<svg width="301pt" height="797pt"
 viewBox="0.00 0.00 300.79 797.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 793)">
<title>A</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-793 296.7947,-793 296.7947,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_a</title>
<polygon fill="none" stroke="#000000" points="8,-387 8,-712 254,-712 254,-387 8,-387"/>
<text text-anchor="middle" x="131" y="-696.8" font-family="Times,serif" font-size="14.00" fill="#000000">get()</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_b</title>
<polygon fill="none" stroke="#000000" points="23,-8 23,-368 165,-368 165,-8 23,-8"/>
<text text-anchor="middle" x="94" y="-352.8" font-family="Times,serif" font-size="14.00" fill="#000000">show()</text>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<ellipse fill="none" stroke="#000000" cx="184" cy="-771" rx="27" ry="18"/>
<text text-anchor="middle" x="184" y="-767.3" font-family="Times,serif" font-size="14.00" fill="#000000">fp</text>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<polygon fill="none" stroke="#000000" points="230,-681 138,-681 138,-645 230,-645 230,-681"/>
<text text-anchor="middle" x="184" y="-659.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">readLine()</text>
</g>
<!-- N1&#45;&gt;N2 -->
<g id="edge1" class="edge">
<title>N1&#45;&gt;N2</title>
<path fill="none" stroke="#000000" d="M184,-752.6793C184,-735.821 184,-710.5651 184,-691.147"/>
<polygon fill="#000000" stroke="#000000" points="187.5001,-691.0501 184,-681.0502 180.5001,-691.0502 187.5001,-691.0501"/>
<text text-anchor="middle" x="203" y="-723.8" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N4 -->
<g id="node4" class="node">
<title>N4</title>
<polygon fill="none" stroke="#000000" points="172,-556 88,-556 88,-520 172,-520 172,-556"/>
<text text-anchor="middle" x="130" y="-534.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">indexOf()</text>
</g>
<!-- N2&#45;&gt;N4 -->
<g id="edge2" class="edge">
<title>N2&#45;&gt;N4</title>
<path fill="none" stroke="red" stroke-width="3" d="M176.1479,-644.8239C167.1497,-623.9946 152.3056,-589.6333 141.8884,-565.5193"/>
<polygon fill="red" stroke="red" points="145.0404,-563.99 137.8615,-556.198 138.6144,-566.7661 145.0404,-563.99"/>
<text text-anchor="middle" x="178" y="-596.8" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N6 -->
<g id="node6" class="node">
<title>N6</title>
<polygon fill="none" stroke="#000000" points="179.5,-431 80.5,-431 80.5,-395 179.5,-395 179.5,-431"/>
<text text-anchor="middle" x="130" y="-409.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">substring()</text>
</g>
<!-- N2&#45;&gt;N6 -->
<g id="edge4" class="edge">
<title>N2&#45;&gt;N6</title>
<path fill="none" stroke="#000000" d="M195.0166,-644.8274C201.3258,-632.7139 208,-616.1913 208,-600.5 208,-600.5 208,-600.5 208,-475.5 208,-459.118 197.3924,-446.3189 184.0009,-436.6879"/>
<polygon fill="#000000" stroke="#000000" points="185.6684,-433.5979 175.3729,-431.097 181.8617,-439.4724 185.6684,-433.5979"/>
<text text-anchor="middle" x="227" y="-534.3" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<polygon fill="none" stroke="#000000" points="104,-681 50,-681 50,-645 104,-645 104,-681"/>
<text text-anchor="middle" x="77" y="-659.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">&#39; &#39;</text>
</g>
<!-- N3&#45;&gt;N4 -->
<g id="edge3" class="edge">
<title>N3&#45;&gt;N4</title>
<path fill="none" stroke="#000000" d="M78.5297,-644.8344C80.2411,-630.3271 83.7865,-609.7294 91,-593 95.3103,-583.0035 101.6359,-573.0116 107.9437,-564.3401"/>
<polygon fill="#000000" stroke="#000000" points="110.8998,-566.2351 114.1702,-556.1576 105.3292,-561.9961 110.8998,-566.2351"/>
<text text-anchor="middle" x="110" y="-596.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg0</text>
</g>
<!-- N4&#45;&gt;N6 -->
<g id="edge6" class="edge">
<title>N4&#45;&gt;N6</title>
<path fill="none" stroke="red" stroke-width="3" d="M130,-519.8239C130,-499.2723 130,-465.5472 130,-441.4893"/>
<polygon fill="red" stroke="red" points="133.5001,-441.198 130,-431.198 126.5001,-441.198 133.5001,-441.198"/>
<text text-anchor="middle" x="149" y="-471.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg1</text>
</g>
<!-- N5 -->
<g id="node5" class="node">
<title>N5</title>
<polygon fill="none" stroke="#000000" points="70,-556 16,-556 16,-520 70,-520 70,-556"/>
<text text-anchor="middle" x="43" y="-534.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">0</text>
</g>
<!-- N5&#45;&gt;N6 -->
<g id="edge5" class="edge">
<title>N5&#45;&gt;N6</title>
<path fill="none" stroke="#000000" d="M54.0754,-519.8986C62.9531,-505.6074 75.8861,-485.2677 88,-468 94.7619,-458.3613 102.5016,-448.0422 109.4796,-438.9762"/>
<polygon fill="#000000" stroke="#000000" points="112.2585,-441.1041 115.6239,-431.058 106.7282,-436.8127 112.2585,-441.1041"/>
<text text-anchor="middle" x="107" y="-471.8" font-family="Times,serif" font-size="14.00" fill="#000000">#arg0</text>
</g>
<!-- N9 -->
<g id="node7" class="node">
<title>N9</title>
<polygon fill="none" stroke="#000000" points="157,-337 103,-337 103,-301 157,-301 157,-337"/>
<text text-anchor="middle" x="130" y="-315.3" font-family="Courier,monospace" font-size="14.00" fill="gray">name</text>
</g>
<!-- N6&#45;&gt;N9 -->
<g id="edge7" class="edge">
<title>N6&#45;&gt;N9</title>
<path fill="none" stroke="red" stroke-width="3" d="M130,-394.8759C130,-381.3516 130,-362.6192 130,-347.1514"/>
<polygon fill="red" stroke="red" points="133.5001,-347.0685 130,-337.0685 126.5001,-347.0685 133.5001,-347.0685"/>
</g>
<!-- N11 -->
<g id="node10" class="node">
<title>N11</title>
<polygon fill="none" stroke="#000000" points="142,-212 88,-212 88,-176 142,-176 142,-212"/>
<text text-anchor="middle" x="115" y="-190.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- N9&#45;&gt;N11 -->
<g id="edge8" class="edge">
<title>N9&#45;&gt;N11</title>
<path fill="none" stroke="red" stroke-width="3" d="M127.8189,-300.8239C125.3416,-280.1798 121.2692,-246.2431 118.3798,-222.1648"/>
<polygon fill="red" stroke="red" points="121.8504,-221.7097 117.1838,-212.198 114.9002,-222.5438 121.8504,-221.7097"/>
<text text-anchor="middle" x="127" y="-252.8" font-family="Times,serif" font-size="14.00" fill="#000000">L</text>
</g>
<!-- N8 -->
<g id="node8" class="node">
<title>N8</title>
<ellipse fill="none" stroke="#000000" cx="233" cy="-121" rx="59.5901" ry="18"/>
<text text-anchor="middle" x="233" y="-117.3" font-family="Times,serif" font-size="14.00" fill="#000000">System.out</text>
</g>
<!-- N12 -->
<g id="node11" class="node">
<title>N12</title>
<polygon fill="none" stroke="#000000" points="157,-52 73,-52 73,-16 157,-16 157,-52"/>
<text text-anchor="middle" x="115" y="-30.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">println()</text>
</g>
<!-- N8&#45;&gt;N12 -->
<g id="edge11" class="edge">
<title>N8&#45;&gt;N12</title>
<path fill="none" stroke="#000000" d="M210.2484,-104.2255C192.5512,-91.1776 167.7499,-72.8919 147.8916,-58.2506"/>
<polygon fill="#000000" stroke="#000000" points="149.8446,-55.3421 139.7187,-52.2248 145.6905,-60.9763 149.8446,-55.3421"/>
<text text-anchor="middle" x="200" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#000000">#this</text>
</g>
<!-- N10 -->
<g id="node9" class="node">
<title>N10</title>
<polygon fill="none" stroke="#000000" points="85,-337 31,-337 31,-301 85,-301 85,-337"/>
<text text-anchor="middle" x="58" y="-315.3" font-family="Courier,monospace" font-size="14.00" fill="#000000">!!</text>
</g>
<!-- N10&#45;&gt;N11 -->
<g id="edge9" class="edge">
<title>N10&#45;&gt;N11</title>
<path fill="none" stroke="#000000" d="M66.2883,-300.8239C75.7865,-279.9946 91.4552,-245.6333 102.4512,-221.5193"/>
<polygon fill="#000000" stroke="#000000" points="105.7372,-222.7489 106.7017,-212.198 99.3681,-219.8445 105.7372,-222.7489"/>
<text text-anchor="middle" x="93" y="-252.8" font-family="Times,serif" font-size="14.00" fill="#000000">R</text>
</g>
<!-- N11&#45;&gt;N12 -->
<g id="edge10" class="edge">
<title>N11&#45;&gt;N12</title>
<path fill="none" stroke="red" stroke-width="3" d="M115,-175.957C115,-148.3487 115,-95.3746 115,-62.5255"/>
<polygon fill="red" stroke="red" points="118.5001,-62.2225 115,-52.2226 111.5001,-62.2226 118.5001,-62.2225"/>
<text text-anchor="middle" x="134" y="-117.3" font-family="Times,serif" font-size="14.00" fill="#000000">#arg0</text>
</g>
</g>
</svg>
</div>

<p>
The final use flow of <code><mark>line</mark></code>:
<ul>
  <li> <code>fp.readLine()</code> &rarr; <code><mark>line</mark></code> &rarr; <code>#this:indexOf()</code> &rarr; <code>#arg1:substring()</code> &rarr; <code>assign:name</code> &rarr; <code>L:+</code> &rarr; <code>#arg0:println()</code>
</ul>
This path represents the usage of the variable <code>line</code> in this program.


<h2 id="learning">5. Training and Prediction</h2>
<p>
Trained a Bayesian probabilistic model that predicts a variable name from a
given use flow:
<div class=figure>
<svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     version="1.1" width="620" height="110">
  <defs>
    <marker id="arrow" viewBox="-5 -5 10 10" orient="auto">
      <polygon points="-5,-5 5,0 -5,5" fill="black" stroke="none" />
    </marker>
  </defs>
  <g stroke="black" fill="none"
     stroke-width="2" stroke-dasharray="4,6" marker-end="url(#arrow)">
    <path d="M60,50 q20,-50,80,-20" />
    <path d="M300,50 q-20,30,-80,20" />
    <path d="M430,50 q-60,60,-220,25" />
    <path d="M560,50 q-200,80,-360,30" />
  </g>
  <g stroke="black" fill="white" stroke-width="1">
    <ellipse cx="60" cy="50" rx="50" ry="20" />
    <rect x="150" y="35" width="60" height="30" fill="yellow" />
    <ellipse cx="300" cy="50" rx="50" ry="20" />
    <ellipse cx="430" cy="50" rx="50" ry="20" />
    <ellipse cx="560" cy="50" rx="50" ry="20" />
  </g>
  <g stroke="black" fill="none" stroke-width="1">
    <path d="M110,50 l40,0" />
    <path d="M210,50 l40,0" />
    <path d="M350,50 l30,0" />
    <path d="M480,50 l30,0" />
  </g>
  <g text-anchor="middle" style="font-family: monospace; font-size: 80%;">
    <text x="60" y="50" dy="0.4em">fp.readline()</text>
    <text x="180" y="50" dy="0.4em">line</text>
    <text x="300" y="50" dy="0.4em">#this:indexOf()</text>
    <text x="430" y="50" dy="0.4em">#arg1:substring()</text>
    <text x="560" y="50" dy="0.4em">assign:name</text>
  </g>
</svg>
</div>
<p>
The following use flow predicts <code><kbd>???</kbd></code> = <code>line</code>:
<ul>
  <li> <code>fp.readLine()</code> &rarr; <code><kbd>???</kbd></code> &rarr; <code>#this:indexOf()</code> &rarr; <code>#arg1:substring()</code> &rarr; <code>assign:name</code> &rarr; <code>L:+</code> &rarr; <code>#arg0:println()</code>
</ul>
<p>
If the variable name is other than <code>line</code>,
it is <strong>inconsistent</strong> with this usage.
<p>
Algorithm:
<ul>
<li> Let V be all the variables.
<li> For each v<sub>1</sub> &isin; V:
<ol>
<li> For each <em>v</em> &isin; V except v<sub>1</sub>
(<em>v</em> &ne; v<sub>1</sub>),
  compute P(<em>v</em>.name | <em>v</em>.useflow).
<li> Find the variable name n
  such that argmax P(name | <em>v<sub>1</sub></em>.useflow).
<li> The variable name is consistent if n = v<sub>1</sub>.name.
  Otherwise, suggest n as a better name for the variable v<sub>1</sub>.
</ol>
</ul>

<h2 id="evaluation">6. Experiment and Evaluation</h2>
<p>
Evaluated our method with the following projects:
(#edges &lt; #useflow)

<table border align=center>
<tr><th>Project</th><th align=right>kLoC</th><th align=right>#vars</th>
<th align=right>#nodes</th><th align=right>#edges</th></tr>
<tr><td>ant (build tool)</td><td align=right>112k</td><td align=right>23,971</td>
<td align=right>350k</td><td align=right>5,211k</td></tr>
<tr><td>antlr4 (parser generator)</td><td align=right>31k</td><td align=right>7,131</td>
<td align=right>74k</td><td align=right>1,103k</td></tr>
<tr><td>bcel (byte code analyzer)</td><td align=right>31k</td><td align=right>6,583</td>
<td align=right>80k</td><td align=right>1,190k</td></tr>
<tr><td>compress (data compression)</td><td align=right>24k</td><td align=right>5,896</td>
<td align=right>69k</td><td align=right>929k</td></tr>
<tr><td>jedit (text editor)</td><td align=right>115k</td><td align=right>21,977</td>
<td align=right>294k</td><td align=right>6,106k</td></tr>
<tr><td>jhotdraw (diagram renderer)</td><td align=right>80k</td><td align=right>17,367</td>
<td align=right>235k</td><td align=right>2,351k</td></tr>
<tr><td>junit (unit testing)</td><td align=right>9k</td><td align=right>2,384</td>
<td align=right>21k</td><td align=right>280k</td></tr>
<tr><td>lucene (document indexing)</td><td align=right>109k</td><td align=right>30,341</td>
<td align=right>414k</td><td align=right>7,146k</td></tr>
<tr><td>tomcat (web server)</td><td align=right>238k</td><td align=right>49,275</td>
<td align=right>649k</td><td align=right>11,799k</td></tr>
<tr><td>weka (machine learning)</td><td align=right>324k</td><td align=right>59,274</td>
<td align=right>943k</td><td align=right>13,224k</td></tr>
<tr><td>xerces (XML parser)</td><td align=right>114k</td><td align=right>21,852</td>
<td align=right>314k</td><td align=right>7,017k</td></tr>
<tr><td>xz (data compression)</td><td align=right>7k</td><td align=right>1,825</td>
<td align=right>23k</td><td align=right>299k</td></tr>
</table>

<p>
Test subjects: authors (3) + grad students (6) = 9 people.

<h3 id="rq1">RQ1. Is Use Flow a Good Representation for Variable Usage?</h3>

<h4>Experiment 1. Variable Equivalence Test</h4>

<p>
Present a pair of variables (whose names hidden) to human subjects:

<div class=example>
<div class=pair>Pair R003</div>
<div class=cat><span id="R003" class=ui>Choice: <select><option value="x">x. ???</option><option value="a">a. MUST BE the same name</option><option value="b">b. CAN BE the same name</option><option value="c">c. MUST NOT BE the same name</option></select></span></div>
<div>DefaultJspCompilerAdapter.java <pre class=src0>
     ...

  100:     */
  101:    protected void addArg(CommandlineJava <mark>aa</mark>, String argument, String value) {
  102:        if (value != null) {
  103:            <mark>aa</mark>.createArgument().setValue(argument);
  104:            <mark>aa</mark>.createArgument().setValue(value);
  105:        }
     ...

</pre></div>
<div>DefaultJspCompilerAdapter.java <pre class=src1>
     ...

   87:     */
   88:    protected void addArg(CommandlineJava <mark>bb</mark>, String argument) {
   89:        if (argument != null &amp;&amp; !argument.isEmpty()) {
   90:           <mark>bb</mark>.createArgument().setValue(argument);
   91:        }
     ...

</pre></div>
</div>

<p>
Tested for 12 projects × 5 variable pairs × 9 subjects = 540 questionnaires.
<ul>
<li> Ratio of #MustBeSame + #CanBeSame = 68% (369/540)
<li> High similarity in use flows = the same variable name.
</ul>

<div class=figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="300" version="1.1"><g fill="none" stroke="black" stroke-width="2"><line x1="10" y1="210" x2="10" y2="10" /><line x1="10" y1="210" x2="290" y2="210" /><rect fill="#0f0" x="20" y="10" width="10" height="102" /><rect fill="#0cf" x="20" y="112" width="10" height="76" /><rect fill="#f0f" x="20" y="188" width="10" height="22" /><rect fill="#000" x="20" y="211" width="10" height="0" /><rect fill="#0f0" x="40" y="10" width="10" height="58" /><rect fill="#0cf" x="40" y="68" width="10" height="98" /><rect fill="#f0f" x="40" y="166" width="10" height="40" /><rect fill="#000" x="40" y="207" width="10" height="4" /><rect fill="#0f0" x="60" y="10" width="10" height="13" /><rect fill="#0cf" x="60" y="23" width="10" height="49" /><rect fill="#f0f" x="60" y="73" width="10" height="138" /><rect fill="#000" x="60" y="211" width="10" height="0" /><rect fill="#0f0" x="80" y="10" width="10" height="44" /><rect fill="#0cf" x="80" y="54" width="10" height="40" /><rect fill="#f0f" x="80" y="95" width="10" height="107" /><rect fill="#000" x="80" y="202" width="10" height="9" /><rect fill="#0f0" x="100" y="10" width="10" height="31" /><rect fill="#0cf" x="100" y="41" width="10" height="111" /><rect fill="#f0f" x="100" y="153" width="10" height="40" /><rect fill="#000" x="100" y="193" width="10" height="18" /><rect fill="#0f0" x="120" y="10" width="10" height="67" /><rect fill="#0cf" x="120" y="77" width="10" height="76" /><rect fill="#f0f" x="120" y="153" width="10" height="53" /><rect fill="#000" x="120" y="207" width="10" height="4" /><rect fill="#0f0" x="140" y="10" width="10" height="62" /><rect fill="#0cf" x="140" y="72" width="10" height="93" /><rect fill="#f0f" x="140" y="166" width="10" height="44" /><rect fill="#000" x="140" y="211" width="10" height="0" /><rect fill="#0f0" x="160" y="10" width="10" height="80" /><rect fill="#0cf" x="160" y="90" width="10" height="93" /><rect fill="#f0f" x="160" y="184" width="10" height="27" /><rect fill="#000" x="160" y="211" width="10" height="0" /><rect fill="#0f0" x="180" y="10" width="10" height="49" /><rect fill="#0cf" x="180" y="59" width="10" height="120" /><rect fill="#f0f" x="180" y="179" width="10" height="27" /><rect fill="#000" x="180" y="207" width="10" height="4" /><rect fill="#0f0" x="200" y="10" width="10" height="18" /><rect fill="#0cf" x="200" y="28" width="10" height="124" /><rect fill="#f0f" x="200" y="153" width="10" height="53" /><rect fill="#000" x="200" y="207" width="10" height="4" /><rect fill="#0f0" x="220" y="10" width="10" height="53" /><rect fill="#0cf" x="220" y="63" width="10" height="98" /><rect fill="#f0f" x="220" y="162" width="10" height="40" /><rect fill="#000" x="220" y="202" width="10" height="9" /><rect fill="#0f0" x="240" y="10" width="10" height="18" /><rect fill="#0cf" x="240" y="28" width="10" height="67" /><rect fill="#f0f" x="240" y="95" width="10" height="116" /><rect fill="#000" x="240" y="211" width="10" height="0" /><rect fill="#0f0" x="270" y="10" width="10" height="50" /><rect fill="#0cf" x="270" y="60" width="10" height="87" /><rect fill="#f0f" x="270" y="147" width="10" height="59" /><rect fill="#000" x="270" y="207" width="10" height="4" /><rect fill="#0f0" x="300" y="10" width="10" height="10" /><rect fill="#0cf" x="300" y="40" width="10" height="10" /><rect fill="#f0f" x="300" y="70" width="10" height="10" /><rect fill="#000" x="300" y="100" width="10" height="10" /></g><g style="font-size: 75%;"><text transform="translate(20,215) rotate(90)" x="0" y="0">ant</text><text transform="translate(40,215) rotate(90)" x="0" y="0">antlr4</text><text transform="translate(60,215) rotate(90)" x="0" y="0">bcel</text><text transform="translate(80,215) rotate(90)" x="0" y="0">compress</text><text transform="translate(100,215) rotate(90)" x="0" y="0">jedit</text><text transform="translate(120,215) rotate(90)" x="0" y="0">jhotdraw</text><text transform="translate(140,215) rotate(90)" x="0" y="0">junit</text><text transform="translate(160,215) rotate(90)" x="0" y="0">lucene</text><text transform="translate(180,215) rotate(90)" x="0" y="0">tomcat</text><text transform="translate(200,215) rotate(90)" x="0" y="0">weka</text><text transform="translate(220,215) rotate(90)" x="0" y="0">xerces</text><text transform="translate(240,215) rotate(90)" x="0" y="0">xz</text><text transform="translate(270,215) rotate(90)" x="0" y="0">Avg.</text><text x="315" y="20">MustBeSame</text><text x="315" y="50">CanBeSame</text><text x="315" y="80">Different</text><text x="315" y="110">Unknown</text></g></svg>
</div>
<p>
<strong>Defects:</strong>
Only tested with the high similarity pairs.
Therefore the test was not completely blind. :(

<h3 id="rq2">RQ2. Can the System Predict a Good (Consistent) Variable Name?</h3>

<h4>Experiment 2-1. Name Suggestion Test</h4>

<p>
Present a snippet to human subjects:
<div class=example>
<div class=rewrite>Rewrite R000 (11.118)</div>
<div class=cat><span id="R000" class=ui>Choice: <code class=old><mark>xxx</mark></code> &rarr; <select><option value="x">x. ???</option><option value="a">a. msg</option><option value="b">b. message</option><option value="c">c. name</option></select></span></div>
<div class=old style="margin: 1em;">
<div>BuildException.java <pre class=src>
     ...

   82:     */
   83:    public BuildException(<mark>String xxx</mark>, Throwable cause, Location location) {
   84:        this(<mark>xxx</mark>, cause);
   85:        this.location = location;
     ...

</pre></div>
</div>
<div class=evidence>Evidence</div>
<div class=new style="margin: 1em;">
<div>BuildException.java <pre class=src>
     ...

   67:     */
   68:    public BuildException(<mark>String message</mark>, Throwable cause) {
   69:        <mark>super(<mark>message</mark>, cause);</mark>
   70:    }
     ...

</pre></div>
</div>
</div>

<p>
Their choices are (in random order):
<ol type=a>
<li> Original name (Orig)
<li> Our system suggestion (Ours)
<li> Baseline suggestion (Baseline)
</ol>
<p>
Tested for 12 projects × 10 variables × 9 subjects = 1,080 questionnaires.
<ul>
<li> For the 39% (416/1080) variables, our suggestion were chosen.
<li> The degree of agreement (<a href="https://en.wikipedia.org/wiki/Cohen%27s_kappa#Fleiss'_kappa">Fleiss' Kappa</a>) = 0.45 (Moderate).
</ul>

<div class=figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="300" version="1.1"><g fill="none" stroke="black" stroke-width="2"><line x1="10" y1="210" x2="10" y2="10" /><line x1="10" y1="210" x2="290" y2="210" /><rect fill="#0f0" x="20" y="10" width="10" height="87" /><rect fill="#f0f" x="20" y="97" width="10" height="113" /><rect fill="#0f0" x="40" y="10" width="10" height="76" /><rect fill="#f0f" x="40" y="86" width="10" height="124" /><rect fill="#0f0" x="60" y="10" width="10" height="107" /><rect fill="#f0f" x="60" y="117" width="10" height="93" /><rect fill="#0f0" x="80" y="10" width="10" height="118" /><rect fill="#f0f" x="80" y="128" width="10" height="82" /><rect fill="#0f0" x="100" y="10" width="10" height="53" /><rect fill="#f0f" x="100" y="63" width="10" height="147" /><rect fill="#0f0" x="120" y="10" width="10" height="9" /><rect fill="#f0f" x="120" y="19" width="10" height="191" /><rect fill="#0f0" x="140" y="10" width="10" height="76" /><rect fill="#f0f" x="140" y="86" width="10" height="124" /><rect fill="#0f0" x="160" y="10" width="10" height="89" /><rect fill="#f0f" x="160" y="99" width="10" height="111" /><rect fill="#0f0" x="180" y="10" width="10" height="76" /><rect fill="#f0f" x="180" y="86" width="10" height="124" /><rect fill="#0f0" x="200" y="10" width="10" height="64" /><rect fill="#f0f" x="200" y="74" width="10" height="136" /><rect fill="#0f0" x="220" y="10" width="10" height="69" /><rect fill="#f0f" x="220" y="79" width="10" height="131" /><rect fill="#0f0" x="240" y="10" width="10" height="102" /><rect fill="#f0f" x="240" y="112" width="10" height="98" /><rect fill="#0f0" x="270" y="10" width="10" height="77" /><rect fill="#f0f" x="270" y="87" width="10" height="123" /><rect fill="#0f0" x="300" y="10" width="10" height="10" /><rect fill="#f0f" x="300" y="40" width="10" height="10" /></g><g style="font-size: 75%;"><text transform="translate(20,215) rotate(90)" x="0" y="0">ant</text><text transform="translate(40,215) rotate(90)" x="0" y="0">antlr4</text><text transform="translate(60,215) rotate(90)" x="0" y="0">bcel</text><text transform="translate(80,215) rotate(90)" x="0" y="0">compress</text><text transform="translate(100,215) rotate(90)" x="0" y="0">jedit</text><text transform="translate(120,215) rotate(90)" x="0" y="0">jhotdraw</text><text transform="translate(140,215) rotate(90)" x="0" y="0">junit</text><text transform="translate(160,215) rotate(90)" x="0" y="0">lucene</text><text transform="translate(180,215) rotate(90)" x="0" y="0">tomcat</text><text transform="translate(200,215) rotate(90)" x="0" y="0">weka</text><text transform="translate(220,215) rotate(90)" x="0" y="0">xerces</text><text transform="translate(240,215) rotate(90)" x="0" y="0">xz</text><text transform="translate(270,215) rotate(90)" x="0" y="0">Avg.</text><text x="315" y="20">Ours</text><text x="315" y="50">Orig+Baseline</text></g></svg>
</div>

<h4>Experiment 2-2. Sending Patches to Developers</h4>
<p>
Based on our results, we manually submitted 12 patches to the open source projects.
<ul>
<li> 3 projects incorporated it.
<li> 2 projects are still in discussion.
<li> 1 projects rejected it.
</ul>

<h3 id="rq3">RQ3. Is the System Output Explainable?</h3>

<h4>Experiment 3. Evidence Persuasiveness Test</h4>
<ol>
<li> Choose 5 variable name suggestions which was highly ranked.
<li> Present the evidences (snippets) used for producing each suggestion.
<li> Ask the subjects to choose one of the following:
<ol type=a>
<li> Presented evidence is convincing. (#Good)
<li> Presented evidence is relevant. (#Soso)
<li> Presented evidence is irrelevant. (#Bad)
<li> Undecidable. (#Unknown)
</ol>
</ol>
<p>
Tested for 12 projects × 5 questions × 9 subjects = 540 questionnaires.
<div class=figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="300" version="1.1"><g fill="none" stroke="black" stroke-width="2"><line x1="10" y1="210" x2="10" y2="10" /><line x1="10" y1="210" x2="290" y2="210" /><rect fill="#0f0" x="20" y="10" width="10" height="31" /><rect fill="#0cf" x="20" y="41" width="10" height="36" /><rect fill="#f0f" x="20" y="77" width="10" height="133" /><rect fill="#000" x="20" y="211" width="10" height="0" /><rect fill="#0f0" x="40" y="10" width="10" height="36" /><rect fill="#0cf" x="40" y="46" width="10" height="36" /><rect fill="#f0f" x="40" y="82" width="10" height="129" /><rect fill="#000" x="40" y="211" width="10" height="0" /><rect fill="#0f0" x="60" y="10" width="10" height="44" /><rect fill="#0cf" x="60" y="54" width="10" height="67" /><rect fill="#f0f" x="60" y="122" width="10" height="89" /><rect fill="#000" x="60" y="211" width="10" height="0" /><rect fill="#0f0" x="80" y="10" width="10" height="22" /><rect fill="#0cf" x="80" y="32" width="10" height="22" /><rect fill="#f0f" x="80" y="55" width="10" height="151" /><rect fill="#000" x="80" y="207" width="10" height="4" /><rect fill="#0f0" x="100" y="10" width="10" height="27" /><rect fill="#0cf" x="100" y="37" width="10" height="27" /><rect fill="#f0f" x="100" y="64" width="10" height="147" /><rect fill="#000" x="100" y="211" width="10" height="0" /><rect fill="#0f0" x="120" y="10" width="10" height="18" /><rect fill="#0cf" x="120" y="28" width="10" height="22" /><rect fill="#f0f" x="120" y="51" width="10" height="160" /><rect fill="#000" x="120" y="211" width="10" height="0" /><rect fill="#0f0" x="140" y="10" width="10" height="9" /><rect fill="#0cf" x="140" y="19" width="10" height="31" /><rect fill="#f0f" x="140" y="51" width="10" height="160" /><rect fill="#000" x="140" y="211" width="10" height="0" /><rect fill="#0f0" x="160" y="10" width="10" height="13" /><rect fill="#0cf" x="160" y="23" width="10" height="62" /><rect fill="#f0f" x="160" y="86" width="10" height="120" /><rect fill="#000" x="160" y="207" width="10" height="4" /><rect fill="#0f0" x="180" y="10" width="10" height="31" /><rect fill="#0cf" x="180" y="41" width="10" height="31" /><rect fill="#f0f" x="180" y="73" width="10" height="138" /><rect fill="#000" x="180" y="211" width="10" height="0" /><rect fill="#0f0" x="200" y="10" width="10" height="4" /><rect fill="#0cf" x="200" y="14" width="10" height="44" /><rect fill="#f0f" x="200" y="59" width="10" height="151" /><rect fill="#000" x="200" y="211" width="10" height="0" /><rect fill="#0f0" x="220" y="10" width="10" height="27" /><rect fill="#0cf" x="220" y="37" width="10" height="44" /><rect fill="#f0f" x="220" y="82" width="10" height="124" /><rect fill="#000" x="220" y="207" width="10" height="4" /><rect fill="#0f0" x="240" y="10" width="10" height="4" /><rect fill="#0cf" x="240" y="14" width="10" height="31" /><rect fill="#f0f" x="240" y="46" width="10" height="156" /><rect fill="#000" x="240" y="202" width="10" height="9" /><rect fill="#0f0" x="270" y="10" width="10" height="22" /><rect fill="#0cf" x="270" y="32" width="10" height="38" /><rect fill="#f0f" x="270" y="71" width="10" height="138" /><rect fill="#000" x="270" y="209" width="10" height="2" /><rect fill="#0f0" x="300" y="10" width="10" height="10" /><rect fill="#0cf" x="300" y="40" width="10" height="10" /><rect fill="#f0f" x="300" y="70" width="10" height="10" /><rect fill="#000" x="300" y="100" width="10" height="10" /></g><g style="font-size: 75%;"><text transform="translate(20,215) rotate(90)" x="0" y="0">ant</text><text transform="translate(40,215) rotate(90)" x="0" y="0">antlr4</text><text transform="translate(60,215) rotate(90)" x="0" y="0">bcel</text><text transform="translate(80,215) rotate(90)" x="0" y="0">compress</text><text transform="translate(100,215) rotate(90)" x="0" y="0">jedit</text><text transform="translate(120,215) rotate(90)" x="0" y="0">jhotdraw</text><text transform="translate(140,215) rotate(90)" x="0" y="0">junit</text><text transform="translate(160,215) rotate(90)" x="0" y="0">lucene</text><text transform="translate(180,215) rotate(90)" x="0" y="0">tomcat</text><text transform="translate(200,215) rotate(90)" x="0" y="0">weka</text><text transform="translate(220,215) rotate(90)" x="0" y="0">xerces</text><text transform="translate(240,215) rotate(90)" x="0" y="0">xz</text><text transform="translate(270,215) rotate(90)" x="0" y="0">Avg.</text><text x="315" y="20">Good</text><text x="315" y="50">Soso</text><text x="315" y="80">Bad</text><text x="315" y="110">Unknown</text></g></svg></div>

<p>
The results did not know that our system produced good explanation
for its suggestions. :(

<h3 id="examples">Anecdotal Examples</h3>
<p>
Some of the system suggestions were good:
<ul>
<li> Make the name more task oriented:
<pre>
org/apache/bcel/Const.java:
-  public static short getNoOfOperands(final int index) {
-      return NO_OF_OPERANDS[index];
+  public static short getNoOfOperands(final int <mark>opcode</mark>) {
+      return NO_OF_OPERANDS[<mark>opcode</mark>];
</pre>

<li> Use the conventional abbreviation for the project.
<pre>
gjt/sp/jedit/bsh/classpath/BshClassPath.java:
-	void errorWhileMapping( String s ) {
+	void errorWhileMapping( String <mark>msg</mark> ) {
...
</pre>
<pre>
org/apache/jasper/compiler/Generator.java
-            String pkgName = className.substring(0, lastIndex);
-            genPreamblePackage(pkgName);
+            String <mark>packageName</mark> = className.substring(0, lastIndex);
+            genPreamblePackage(<mark>packageName</mark>);
</pre>

<li> Use a synonym which aligns better with the other parts of the project.
<pre>
org/apache/xerces/impl/xpath/regex/RegexParser.java
-        ReferencePosition(int n, int pos) {
+        ReferencePosition(int n, int <mark>offset</mark>) {
</pre>

<li> Correct typos:
<pre>
src/org/tukaani/xz/lz/Hash234.java
-    void normalize(int normalizeOffset) {
-        LZEncoder.normalize(hash2Table, HASH_2_SIZE, normalizeOffset);
+    void normalize(int <mark>normalizationOffset</mark>) {
+        LZEncoder.normalize(hash2Table, HASH_2_SIZE, <mark>normalizationOffset</mark>);
...
</pre>
</ul>


<h2 id="discussion">7. Discussion</h2>
<ol>
<li> Use flows are somewhat good at representing the variable usage.
<li> In real projects, our system suggested a better (more consistent) name
  than the original with 39% probability.
<li> We are not sure that our system produced a good explaination for its output.
</ol>

<h3 id="threats">7.1. Threats to Validity</h3>
<h4>Internal Validity (Did we answer RQs?)</h4>
<ol type=a>
<li> The subjects might have a prior knowledge about the projects used.
<li> The results depend on each subject's proficiency of the language.
<li> It is not clear how many variables the proposed method can apply to.
<li> Not every use flow is correctly obtained.
</ol>
<h4>External Validity (Is our result generalizable?)</h4>
<ol type=a>
<li> The programming language is limited to Java.
<li> Not enough projects are tested with enough subjects.
<li> Dynamic dispatching or variable aliasing is not considered.
<li> Naive Bayes classifier could be improved.
</ol>

<h2 id="contribution">8. Conclusion</h2>
<ul>
<li> We presented a framework to test the consistency of variable names.
<li> We proposed use flow as the representation of variable usage.
<li> We demonstrated that the proposed method can detect and correct
inconsistent variable names.
</ul>


<hr>
<address>Yusuke Shinyama</address>
